# jvbundler Quick Start Guide

Get started with `jvbundler` in minutes to generate Dockerfiles for your jvagent applications.

## Installation

### From Source (Development)

```bash
cd jvbundler
pip install -e .
```

### For Production

```bash
pip install jvbundler
```

## Basic Usage

### 1. Generate Dockerfile in Current Directory

Navigate to your jvagent app directory and run:

```bash
cd /path/to/your/jvagent_app
jvbundler
```

### 2. Generate Dockerfile for Specific App

Specify the path to your app:

```bash
jvbundler /path/to/your/jvagent_app
```

## Example Walkthrough

Let's create a sample jvagent app and generate a Dockerfile:

### Step 1: Create App Structure

```bash
# Create app directory
mkdir my_jvagent_app
cd my_jvagent_app

# Create app.yaml
cat > app.yaml << EOF
name: my_jvagent_app
version: 1.0.0
description: My awesome jvagent application
EOF
```

### Step 2: Add Actions with Dependencies

Create an action with pip dependencies:

```bash
# Create action directory structure
mkdir -p agents/myorg/assistant/actions/myorg/chat_action

# Create action info.yaml with dependencies
cat > agents/myorg/assistant/actions/myorg/chat_action/info.yaml << EOF
package:
  name: myorg/chat_action
  version: 1.0.0
  dependencies:
    pip:
      - openai>=1.0.0
      - httpx>=0.24.0
      - tiktoken>=0.5.0
EOF
```

Add another action:

```bash
# Create another action
mkdir -p agents/myorg/assistant/actions/myorg/search_action

# Create action info.yaml
cat > agents/myorg/assistant/actions/myorg/search_action/info.yaml << EOF
package:
  name: myorg/search_action
  version: 1.0.0
  dependencies:
    pip:
      - beautifulsoup4>=4.12.0
      - requests>=2.31.0
EOF
```

### Step 3: Generate Dockerfile

```bash
jvbundler
```

**Output:**
```
2026-01-16 09:00:00,000 - jvbundler.cli - INFO - Initializing bundler for app: /path/to/my_jvagent_app
2026-01-16 09:00:00,001 - jvbundler.bundler - INFO - Generating Dockerfile for app: /path/to/my_jvagent_app
2026-01-16 09:00:00,002 - jvbundler.dockerfile_generator - INFO - Discovering action dependencies...
2026-01-16 09:00:00,003 - jvbundler.dockerfile_generator - INFO - Found dependencies for 2 actions
2026-01-16 09:00:00,004 - jvbundler.bundler - INFO - Dockerfile generated successfully: /path/to/my_jvagent_app/Dockerfile

âœ“ Dockerfile generated successfully in /path/to/my_jvagent_app
```

### Step 4: Verify Generated Dockerfile

```bash
cat Dockerfile
```

**Generated Dockerfile:**
```dockerfile
FROM registry.v75inc.dev/jvagent/jvagent-base:latest

WORKDIR /var/task
COPY . /var/task/

# Action-specific pip dependencies
# Dependencies for myorg/chat_action
RUN /opt/venv/bin/pip install --no-cache-dir openai>=1.0.0 httpx>=0.24.0 tiktoken>=0.5.0
# Dependencies for myorg/search_action
RUN /opt/venv/bin/pip install --no-cache-dir beautifulsoup4>=4.12.0 requests>=2.31.0
```

## Common Use Cases

### Debug Mode

See detailed logging during generation:

```bash
jvbundler --debug
```

### Check Version

```bash
jvbundler --version
```

### Get Help

```bash
jvbundler --help
```

## Understanding the Output

The generated Dockerfile includes:

1. **Base Image**: Extends your organization's base jvagent image
2. **Working Directory**: Sets up `/var/task` as the working directory
3. **Application Copy**: Copies your app files into the container
4. **Action Dependencies**: Separate `RUN` commands per action for optimal Docker layer caching

### Why Separate RUN Commands?

Each action gets its own `RUN` command for pip dependencies. This provides:

- **Better Caching**: Docker caches each layer separately
- **Faster Rebuilds**: If only one action's dependencies change, other layers remain cached
- **Clear Organization**: Easy to see which dependencies belong to which action

## App Structure Requirements

Your jvagent app must have:

1. **app.yaml** in the root directory
2. **Actions** following this structure:
   ```
   agents/{namespace}/{agent_name}/actions/{namespace}/{action_name}/info.yaml
   ```

### Example Directory Structure

```
my_jvagent_app/
â”œâ”€â”€ app.yaml                          # Required: App configuration
â”œâ”€â”€ agents/                           # Actions organized by namespace
â”‚   â””â”€â”€ myorg/                        # Namespace directory
â”‚       â””â”€â”€ assistant/                # Agent directory
â”‚           â””â”€â”€ actions/              # Actions directory
â”‚               â””â”€â”€ myorg/            # Action namespace
â”‚                   â”œâ”€â”€ chat_action/  # Action directory
â”‚                   â”‚   â””â”€â”€ info.yaml # Action configuration with dependencies
â”‚                   â””â”€â”€ search_action/
â”‚                       â””â”€â”€ info.yaml
â””â”€â”€ Dockerfile                        # Generated by jvbundler
```

## Action info.yaml Format

Each action's `info.yaml` should include pip dependencies:

```yaml
package:
  name: namespace/action_name
  version: 1.0.0
  dependencies:
    pip:
      - package1>=1.0.0
      - package2==2.3.4
      - package3~=3.0.0
```

**Supported version specifiers:**
- `>=` : Greater than or equal to
- `==` : Exactly equal to
- `<=` : Less than or equal to
- `~=` : Compatible version
- `<` : Less than
- `>` : Greater than

## Next Steps

After generating your Dockerfile:

### 1. Build Docker Image

```bash
docker build -t my-jvagent-app:latest .
```

### 2. Test Locally

```bash
docker run -p 8080:8080 \
  -e JVAGENT_ADMIN_PASSWORD=your-password \
  my-jvagent-app:latest
```

### 3. Push to Registry

```bash
# Tag for your registry
docker tag my-jvagent-app:latest your-registry.com/my-jvagent-app:latest

# Push to registry
docker push your-registry.com/my-jvagent-app:latest
```

### 4. Deploy

Deploy to your target environment (AWS Lambda, Kubernetes, etc.)

## Troubleshooting

### Error: app.yaml not found

**Problem:** jvbundler can't find app.yaml in the specified directory

**Solution:** 
- Ensure you're in the correct directory
- Verify app.yaml exists in the app root
- Check that you're specifying the correct path

```bash
# Check if app.yaml exists
ls -la app.yaml

# Or specify full path
jvbundler /full/path/to/app
```

### No Dependencies Found

**Problem:** Dockerfile generated but no dependencies included

**Possible causes:**
- No actions exist in your app
- Actions don't have info.yaml files
- info.yaml files don't include dependencies section

**Solution:**
```bash
# Enable debug mode to see what's happening
jvbundler --debug

# Verify action structure
find agents -name "info.yaml"

# Check info.yaml format
cat agents/namespace/agent/actions/namespace/action/info.yaml
```

### Base Template Not Found

**Problem:** Error about missing Dockerfile.base template

**Solution:** This indicates an installation issue. Reinstall jvbundler:

```bash
pip install --force-reinstall jvbundler
```

## Advanced Usage

### Using as Python Library

You can also use jvbundler programmatically:

```python
from jvbundler import Bundler

# Create bundler instance
bundler = Bundler(app_root="/path/to/app")

# Generate Dockerfile
success = bundler.generate_dockerfile()

if success:
    print("Dockerfile generated successfully!")
else:
    print("Generation failed!")
```

## Getting Help

- **Documentation**: See [README.md](README.md) for full documentation
- **Issues**: Report issues on GitHub
- **Examples**: Check the test suite for more examples

## Contributing

Contributions are welcome! See the development section in [README.md](README.md).

---

**Happy Bundling! ðŸš€**